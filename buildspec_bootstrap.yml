version: 0.2

phases:
  install:
    runtime-versions:
      docker: 18
    commands:
      - apt-get update -y && apt-get install zip
      - cd tmp
      - wget https://releases.hashicorp.com/terraform/0.12.6/terraform_0.12.6_linux_amd64.zip
      - unzip -o terraform_0.12.6_linux_amd64.zip
      - mv terraform /usr/bin/
      - cd ..
  build:
    commands:
      - terraform init terraform/bootstrap/
      - terraform apply -auto-approve terraform/bootstrap/
  post_build:
    commands:
      - test "$CODEBUILD_BUILD_SUCCEEDING" != '0' && exit 1
      - zip airport_hangout_frontend_source.zip *
      - aws s3 cp airport_hangout_frontend_source.zip s3://com.jefflong.pipelines/airport_hangout_frontend/
